{% extends 'base.html' %}

{% block content %}
{% if user.is_authenticated %}
<nav>
  <a href='{% url "moment_create" %}'>Create your Moment</a>
</nav>
{% endif%}
{% for moment in moment_list %}
{% load static %}
<a href="{% url 'profile' moment.user.id %}">
<div style="display: flex; align-items: center; gap: 8px;">
    {% if moment.user.profile.image %}
        <img
            src="{{ moment.user.profile.image.url }}"
            alt="{{ moment.user.username }}"
            style="width: 24px; height: 24px; border-radius: 50%; object-fit: cover;">
    {% else %}
        <div style="width: 24px; height: 24px; border-radius: 50%; background-color: #8b0000; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 12px;">
            {{ moment.user.username|slice:":1"|upper }}
        </div>
    {% endif %}
    <h3 style="margin: 0; font-size: 16px;">{{ moment.user.username }}</h3>
</div>

</a>

    <p>{{ moment.description }}</p>

    {% if moment.file %}
        {% load static %}
        {% if '.mp4' in moment.file.url or '.webm' in moment.file.url or '.ogg' in moment.file.url or '.mov' in moment.file.url or '.avi' in moment.file.url %}
            <video width="100%" max-width="320px" controls>
                <source src="{{ moment.file.url }}" type="video/mp4">
                Your browser does not support the video tag.
            </video>
        {% elif '.jpg' in moment.file.url or '.jpeg' in moment.file.url or '.png' in moment.file.url or '.gif' in moment.file.url %}
            <img src="{{ moment.file.url }}" alt="Moment image" style="max-width: 640px; width: 100%; height: auto;">
        {% endif %}
    {% endif %}
        {% for comment in moment.comments.all %}
            <p><strong>{{ comment.user.username }}:</strong> {{ comment.review }}</p>
            {% if comment.user == request.user %}
            <form method="POST" action="{% url 'delete_comment' comment.id %}">
                {% csrf_token %}
                <button type='submit'>Delete </button>
            </form>
            {% endif %}
        {% endfor %}

        {% if user.is_authenticated %}
            <form method="post" action="{% url 'create_comment' moment.id %}">
                {% csrf_token %}
                {{ form.as_p }}
                <button type="submit">Submit</button>
            </form>
        {% endif %}

      {% if moment.user == request.user %}
              <a href='{% url "moment_update" moment.pk %}'>Edit Moment</a>
      <form method='post' action='{% url 'moment_delete' moment.pk %}'>
        {% csrf_token %}
        <button type='submit'>Delete</button>
      </form>

    {% endif %}

    {% endfor %}

{% endblock %}
