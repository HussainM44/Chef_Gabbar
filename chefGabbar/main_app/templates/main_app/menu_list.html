{% extends 'base.html' %}

{% block content%}

{% if user.is_superuser %}
<a href="{% url 'menu_create' %}">Create Your Cuisine</a>
{%endif%}
<h1>Menu </h1>
{% comment %}
-------------Search Dishes to Add-----------
 {% endcomment %}
<h2>Search Dishes</h2>
<form method="get" action="{% url 'menu_list' %}">
    <input type="text" name="q" placeholder="Search for a dish..." value="{{ search_query }}">
    <button type="submit">Search</button>
</form>
{% if search_query %}
    <h3>Results for "{{ search_query }}":</h3>
    {% if search_results %}
            {% for dish in search_results %}
<p>{{dish.name}} - {{dish.price}} BHD - {{dish.description}} </p>
{% load static %}
{% if dish.dish_image %}
    <img
        src="{{ dish.dish_image.url }}"
        width="100"
        height="100"
        alt="{{ dish.name }}"
        style="border-radius: 8px; object-fit: cover;">
{% else %}
    <div style="width: 100px; height: 100px; border-radius: 8px; background-color: #ccc; display: flex; align-items: center; justify-content: center; color: #666;">No Image</div>
{% endif %}
              {% if  not user.is_superuser%}
  {% if user.is_authenticated %}
<form method="POST" action="{% url 'add_dish' dish.id %}" >
  {% csrf_token %}
  <button type="submit">➕</button>
</form>
{% endif %}

{% endif %}
            <br>
            {% endfor %}

    {% else %}
        <p>No dishes found.</p>
    {% endif %}
{% endif %}


{% comment %}
-------------All dishes in Menu------------
{% endcomment %}
{% for menu in menu_list %}
<h2>{{menu.cuisine}}</h2>
{% for dish in menu.dish_set.all %}
<p>{{dish.name}} - {{dish.price}} BHD - {{dish.description}} </p>
{% load static %}
{% if dish.dish_image %}
    <img
        src="{{ dish.dish_image.url }}"
        width="100"
        height="100"
        alt="{{ dish.name }}"
        style="border-radius: 8px; object-fit: cover;">
{% else %}
    <div style="width: 100px; height: 100px; border-radius: 8px; background-color: #ccc; display: flex; align-items: center; justify-content: center; color: #666;">No Image</div>
{% endif %}
  {% if  not user.is_superuser%}
  {% if user.is_authenticated %}
<form method="POST" action="{% url 'add_dish' dish.id %}" >
  {% csrf_token %}
  <button type="submit">➕</button>
</form>
{% endif %}

{% endif %}
{% if user.is_superuser %}
<a href= "{% url 'dish_delete' dish.pk %}">Delete {{dish.name}}</a>
<a href= "{% url 'dish_update' dish.pk %}">Update {{dish.name}}</a>
{%endif%}

{% endfor %}

{% if user.is_superuser %}
<a href = "{% url 'dish_create' menu.pk %}">Add A Dish</a>
<br>
<a href = "{% url 'menu_delete' menu.pk %}">Delete {{menu.cuisine}}</a>
</br>
{%endif%}


{% endfor %}

{% comment %}
-------------Bucket to add dishes to order ----------
 {% endcomment %}

{% if buckets %}
<div id="bucket-container">
  <h2 class="a">Bucket</h2>

  {% for bucket in buckets %}
    <h3 class="a">Items:</h3>

    {% if bucket.itemqty_set.all %}
      {% for item in bucket.itemqty_set.all %}
        {% if item.dish %}
          <p>
            <strong>{{ item.dish.name }} </strong>
            {{ item.quantity }} × {{ item.dish.price|floatformat:2 }} BHD =
            {{ item.total|floatformat:2 }} BHD
          </p>

          {% if bucket.service_type == "P" %}
            <form method="POST" action="{% url 'add_dish' item.dish.id %}" style="display:inline;">
              {% csrf_token %}
              <button type="submit">➕</button>
            </form>

            <form method="POST" action="{% url 'decrease_dish' bucket.id item.dish.id %}" style="display:inline;">
              {% csrf_token %}
              <button type="submit">➖</button>
            </form>

            <form method="POST" action="{% url 'single_item_delete' bucket.id item.dish.id %}" style="display:inline;">
              {% csrf_token %}
              <button type="submit">✖️</button>
            </form>
          {% endif %}

          <hr>
        {% endif %}
      {% endfor %}

      <p> <strong>Total: {{ bucket.total_price|floatformat:2 }} BHD </strong></p>

      {% if bucket.service_type == 'P' %}
        <form method="POST" action="{% url 'service_type' bucket.id %}" class="service">
          {% csrf_token %}
          {{ form.as_p }}
          <button type="submit">Submit</button>
        </form>

        <form method="POST" action="{% url 'bucket_delete' bucket.id %}">
          {% csrf_token %}
          <button type="submit">Clear Bucket</button>
        </form>

      {% else %}
        <p class="service">Service Type: {{ bucket.get_service_type_display }}</p>

        {% if bucket.id not in bucket_added %}
          <form method="POST" action="{% url 'checkout' bucket.id %}">
            {% csrf_token %}
            <button type="submit">Pay Online</button>
          </form>

          <form method="POST" action="{% url 'bucketToOrder' bucket.id %}">
            {% csrf_token %}
            <button type="submit">Pay Cash</button>
          </form>

          <form method="POST" action="{% url 'bucket_delete' bucket.id %}">
            {% csrf_token %}
            <button type="submit">Clear Bucket</button>
          </form>
        {% else %}
          <p>Added to Cart ✅</p>
        {% endif %}
      {% endif %}
    {% endif %}
  {% endfor %}
</div>
{% endif %}


{%endblock%}
