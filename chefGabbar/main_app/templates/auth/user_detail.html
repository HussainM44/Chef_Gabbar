{% extends 'base.html' %}

{% block content %}

<div class="profile-container">
  <h1 class="profile-title">Profile</h1>

  <div class="profile-card">
    <h2 class="profile-section-title">Personal Details</h2>

    <div class="profile-user-info">
      <div class="profile-avatar-wrapper">
        {% load static %}
        {% if object.profile.image %}
        <img src="{{ object.profile.image.url }}" alt="{{ object.username }}" class="profile-avatar">
        {% else %}
        <div class="profile-avatar-placeholder">
          {{ object.username|slice:":1"|upper }}
        </div>
        {% endif %}
      </div>

      <div class="profile-details">
        <p class="profile-detail">
          <span class="profile-label">Name:</span>
          <span class="profile-value">{{object.username}}</span>
        </p>
        <p class="profile-detail">
          <span class="profile-label">Email:</span>
          <span class="profile-value">{{object.email}}</span>
        </p>
        <p class="profile-detail">
          <span class="profile-label">Address:</span>
          <span class="profile-value">{{object.profile.address}}</span>
        </p>
      </div>
    </div>

    {% if request.user.id == user.id %}
    <div class="profile-actions">
      <a href="{% url 'user_update' user.id %}" class="profile-edit-btn">Edit Profile</a>
    </div>
    {% endif %}
  </div>

  <div class="profile-moments-section">
    <h3 class="profile-moments-title">{{object.username}}'s Moments</h3>

    {% if moments %}
    <div class="profile-moments-grid">
      {% for moment in moments %}
      <div class="profile-moment-card">
        <p class="profile-moment-description">{{ moment.description }}</p>

        {% if moment.file %}
        <div class="profile-moment-media">
          {% if '.mp4' in moment.file.url or '.webm' in moment.file.url or '.ogg' in moment.file.url or '.mov' in moment.file.url or '.avi' in moment.file.url %}
          <video class="profile-moment-video" controls>
            <source src="{{ moment.file.url }}" type="video/mp4">
            Your browser does not support the video tag.
          </video>
          {% elif '.jpg' in moment.file.url or '.jpeg' in moment.file.url or '.png' in moment.file.url or '.gif' in moment.file.url %}
          <img src="{{ moment.file.url }}" alt="Moment image" class="profile-moment-image">
          {% else %}
          <p class="profile-moment-file">
            <a href="{{ moment.file.url }}" target="_blank" class="profile-moment-link">View File</a>
          </p>
          {% endif %}
        </div>
        {% else %}
        <p class="profile-moment-no-media">No media attached</p>
        {% endif %}

        <p class="profile-moment-date">Posted on {{ moment.created_at|date:"M d, Y" }}</p>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <h4 class="profile-no-moments">No Moments by User yet</h4>
    {% endif %}
  </div>
</div>

{% endblock %}
